{% extends "charts.html" %}
{% block chartField %}

    <form id="form-ipt" class="form-inline" >
        {{ form.userID(class="form-control", maxlength='8', placeholder='工号')}}
        {{ form.dateRange(class="form-control",size='23',placeholder='日期范围') }}
        <input class="btn btn-primary" type="button" value="确认" onclick="refresh_chart()"/>
    </form>

    <div id="chartACValid" style="width: inherit; height: 350px;"></div>

    <script>
        var dateRangePicker = $("input[name='dateRange']");
        dateRangePicker.daterangepicker({
            autoUpdateInput: false,
            locale: {
                format: 'YYYY-MM-DD',
                cancelLabel: 'Clear'
            }
        });
        dateRangePicker.on('apply.daterangepicker', function (ev, picker) {
            $(this).val(picker.startDate.format('YYYY-MM-DD')+' ~ '+picker.endDate.format('YYYY-MM-DD'));
        });
        dateRangePicker.on('cancel.daterangepicker', function (ev, picker) {
            $(this).val('');
        });

        // 图表初始化。
        var chartACValid = echarts.init(document.getElementById('chartACValid'));

        var optionChartACValid = {
            title: {text: '门禁合法比例'},
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            toolbox: {
                show: true,
                feature: {
                    mark: {show: true},
                    dataView: {show: true, readOnly: false},
                    restore: {show: true},
                    saveAsImage: {show: true}
                }
            },
            legend: {data: ['合法','非法']},
            series: [{
                type: 'pie',
                radious: '55%',
                data: []
            }]
        };

        chartACValid.setOption(optionChartACValid);

        var json_acValid;

        refresh_chart = function () {
            chartACValid.showLoading();
            $.get('/charts/acvalid/getData?' + $("#form-ipt").serialize(), function (json_response) {
                chartACValid.hideLoading();
                if (!json_response.errMsg) {
                    chartACValid.setOption({
                        series: [{
                            data: [
                                {value: json_response.valid, name:'合法'},
                                {value: json_response.invalid, name:'非法'}
                            ]
                        }]
                    });
                } else {
                    for (err in json_response.errMsg) {
                        alert(json_response.errMsg[err]);
                    }
                }
            }, 'json')
        };
    </script>

{% endblock %}