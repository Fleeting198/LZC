
{% extends "base.html" %}
{% block chart %}
    <!--在此页中显示输入框，图表作为输出-->
    <form id="form-ipt" method="get">
        <div class="form-group">
            <label class="control-label">工号</label>
            <input class="form-control" name="user_id" type="text" maxlength="8" value="PPQZXPXU" />
        </div>
        <div class="form-group">
            <label class="control-label">起始日期</label>
            <div class="input-group">
	            <input class="form-control" id="ipt-startDate" name="startDate" type="text" readonly="readonly" />
	            <span class="input-group-btn"><input type="button" class="btn btn-default" onclick="clear_picker(1)" value="清除" /></span>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label">结束日期</label>
            <div class="input-group">
	            <input class="form-control" id="ipt-endDate" name="endDate" type="text" readonly="readonly" />
	            <span class="input-group-btn"><input type="button" class="btn btn-default" onclick="clear_picker(2)" value="清除" /></span>
            </div>
        </div>
        <div class="form-group">
			<span>模式</span>
			<label class="checkbox-inline">
  			<input type="radio" name="mode_date" value="0" checked>日</label>
			<label class="checkbox-inline">
  			<input type="radio" name="mode_date" value="1">周</label>
  			<label class="checkbox-inline">
  			<input type="radio" name="mode_date" value="2">月</label>
  			<label class="checkbox-inline">
  			<input type="radio" name="mode_date" value="3">季</label>
  			<label class="checkbox-inline">
  			<input type="radio" name="mode_date" value="4">年</label>
		</div>
        <div class="form-group">
            <input class="btn btn-primary" type="button" value="确认" onclick="refresh_chart()" />
        </div>
    </form>
    
    <div id="chart" style="width: 1000px; height: 600px;"></div>

    <script>

        // datetimepicker初始化
    	$("#ipt-startDate").datetimepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            minView: 2
        });
        $("#ipt-endDate").datetimepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            minView: 2
        });

        // 图表初始化。
        var chart = echarts.init(document.getElementById('chart'));
        var option = {
            title: {text: '支出趋势'},
            tooltip: {trigger: 'axis'},
            toolbox: {
                show: true,
                feature: {
                    mark: {show: true},
                    dataView: {show: true, readOnly: false},
                    magicType: {show: true, type: ['line', 'bar']},
                    restore: {show: true},
                    saveAsImage: {show: true}
                }
            },
            legend: {data: ['累积支出','节点支出']},
            xAxis: {
                type: 'category',
                boundaryGap: true,
                data: []
            },
            yAxis: {
                type: 'value',
                name: '支出',
                axisLabel: {
                    formatter: '{value} 元'
                }
            },
            dataZoom: [
                {
                    type: 'inside',
                    xAxisIndex: [0],
                    start: 0,
                    end: 100
                },
                {
                    type: 'slider',
                    xAxisIndex: [0],
                    start: 0,
                    end: 100
                }
            ],
            series: [
                {
                    name: '累积支出',
                    type: 'line',
                    data: []
                },
                {
                    name: '节点支出',
                    type: 'bar',
                    data: []
                }
            ]
        }
        chart.setOption(option);

        // get向后端请求json刷新图表。
        refresh_chart = function(){
            $.get('/expenditure/refresh?'+$("#form-ipt").serialize(), function(json_response){
                var mdates = json_response.mdates;
                var mamounts = json_response.mamounts;
                var mamounts_point = json_response.mamounts_point;

                chart.setOption({
                    xAxis: [{
                        data: mdates
                    }],
                    series: [
                        {
                            name: '累积支出',
                            data: mamounts
                        },
                        {
                            name: '节点支出',
                            data: mamounts_point
                        }
                    ]
                })

            },'json');
        }

        // 清空datetimepicker
        clear_picker = function(pid){
            switch (pid){
                case 0:
                    $("#ipt-startDate").val('');
                    $("#ipt-endDate").val('');
                case 1:
                	$("#ipt-startDate").val('');
                case 2:
                	$("#ipt-endDate").val('');
            }
        }
    </script>

{% endblock %}